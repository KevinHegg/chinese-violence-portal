---
// Landing page with navbar and cards
import "../styles/tailwind.css";
import Navbar from "../components/Navbar.astro";
import { fetchLynchingsData, fetchLynchingsMainData } from "../utils/googleSheets";

// Disable prerendering to allow dynamic data from Google Sheets
export const prerender = false;

// Fetch lynchings data for count (Public tab) and featured record (Main tab)
const mainTabGid = import.meta.env.PUBLIC_LYNCHINGS_MAIN_GID || "760826284";
const [publicResult, mainResult] = await Promise.allSettled([
  fetchLynchingsData(),
  fetchLynchingsMainData(mainTabGid)
]);

const lynchingsData = publicResult.status === "fulfilled" ? publicResult.value : [];
const lynchingsMainData = mainResult.status === "fulfilled" ? mainResult.value : [];
const incidentCount = lynchingsData.length;
// Calculate total victim count from "number-of-victims" column
const victimCount = lynchingsData.reduce((sum, record) => {
  const victims = parseInt(record["number-of-victims"]) || 0;
  return sum + victims;
}, 0);

// Select a random featured record on each request (prefer Main tab for Narrative Summary)
const featuredSource = lynchingsMainData.length > 0 ? lynchingsMainData : lynchingsData;
const featuredRecord = featuredSource.length > 0
  ? featuredSource[Math.floor(Math.random() * featuredSource.length)]
  : null;
---

<!doctype html>
<html lang="en" data-theme="johncrow">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EHFB9XXVEP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-EHFB9XXVEP');
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>The John Crow Project</title>
    <meta name="description" content="Documenting the history of anti-Chinese lynching, exclusion, and resistance in the American West (1850–1915). Explore interactive records, maps, timelines, and primary-source newspaper articles to uncover this neglected chapter of American history." />
  </head>
  <body class="font-serif" data-current-page="home">
    <Navbar currentPage="home" />
    
    <main class="p-6 pt-8">
      <div class="container-standard">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-display font-bold mb-4 text-base-content">
            The John Crow Project
          </h1>
          
          <p class="text-lg font-body text-base-content/80 max-w-3xl mx-auto leading-relaxed">
            Documenting the history of anti-Chinese lynchings, riots, and massacres<br>in the American West (1850 – 1915)
          </p>
        </div>

        <div class="prose prose-lg mb-8 max-w-none">
          <h2 class="text-2xl font-display font-semibold mb-4 text-base-content">About the Project</h2>
          <p class="font-body text-base-content/90 leading-relaxed mb-6">
            Welcome to the John Crow Project. This site revives a neglected chapter of American history: the white supremacist violence and legal exclusion aimed at Chinese immigrants after the Gold Rush. The first attacks appeared in California's goldfields in 1849, then rolled east along wagon roads, rail lines, and river towns. By the early 1900s the violence had crossed the Mississippi River and collided with the entrenched racism of Jim Crow. Drawing on newly compiled lynching databases, digitized newspapers, and recent scholarship, this website documents how vigilante terror and discriminatory laws worked hand-in-hand to drive Chinese communities from mines, rail camps, and towns.
          </p>
          
          <h2 class="text-2xl font-display font-semibold mb-4 text-base-content mt-8">The Archive</h2>
          <p class="font-body text-base-content/90 leading-relaxed mb-6">
            In the pages of this website, you will find interactive charts and maps of <strong>{incidentCount}</strong> documented incidents resulting in <strong>{victimCount}</strong> extralegal homicides, timelines that pair major exclusion laws with surges in mob violence, and primary-source newspaper articles that preserve the voices of victims, witnesses, and resisters. Our goal is to make this "red record" of the West impossible to ignore, to honor those who were lost, and to provide educators, descendants, and researchers the tools they need to confront the legacy of what we call <em>John Crow</em>—a western counterpart to Jim Crow that sought expulsion rather than segregation.
          </p>
          
          <!-- John Crow Explanation Callout -->
          <div class="bg-amber-50 border-l-4 border-amber-500 rounded-lg p-6 mb-6 shadow-sm not-prose">
            <h3 class="text-xl font-display font-semibold mb-3 text-vintage-ink">What is "John Crow"?</h3>
            <p class="font-body text-base-content/90 leading-relaxed mb-3">
              The term <i>John Crow</i> is a deliberate conceptual framework, modeled in part on <i>Jane Crow</i>, 
              which was coined to name the compounded racial and gendered oppression faced by Black women. 
              Like <i>Jane Crow</i>, <i>John Crow</i> seeks to expose a distinct but parallel regime of racial terror—in this case, 
              one that targeted Chinese immigrants in the American West.
            </p>
            <p class="font-body text-base-content/90 leading-relaxed mb-0">
              "Crow" evokes Jim Crow, the system of white supremacist control 
              that subjugated African Americans in the post-Reconstruction South. "John" derives from John Chinaman, the 19th-century racial caricature 
              that dehumanized Chinese immigrants as alien and unassimilable. By merging these terms, <i>John Crow</i> names a system not of enforced separation, 
              but of violent exclusion: lynchings, purges, exclusion laws, and the destruction of Chinatowns worked to erase Chinese presence from the national body. 
              This project uses John Crow to surface that hidden history and to extend <strong>Ida B. Wells's "Red Record"</strong> into the western landscape of American racial terror.
            </p>
          </div>
          
          <h2 class="text-2xl font-display font-semibold mb-4 text-base-content mt-8">Join the Effort</h2>
          <p class="font-body text-base-content/90 leading-relaxed">
            Explore the evidence, contribute your family's stories, and help us extend this record—what you see here is a starting point, not an endpoint. Together we can uncover, verify, and map new cases and perspectives, transforming collective memory and advancing justice through truth.
          </p>
          <!-- Callout for Submit Form -->
          <div class="mt-8 mb-8 not-prose">
            <div class="bg-amber-100 border-l-4 border-amber-400 rounded-lg p-4 flex flex-col md:flex-row md:items-center gap-3 shadow-sm">
              <div class="flex-1 text-amber-900 text-base">
                <strong>Submit details about acts of lethal violence targeting Chinese immigrants in the U.S. between 1850 and World War I.</strong>
              </div>
              <a href="/submit" class="inline-block mt-2 md:mt-0 px-4 py-2 bg-amber-400 hover:bg-amber-500 text-amber-900 font-semibold rounded shadow transition-colors duration-150 text-sm text-center">Submit an Incident</a>
            </div>
          </div>
        
          <!-- Featured Record Section -->
          {featuredRecord && (
            <div class="mb-8 not-prose">
              <h2 class="text-2xl font-display font-semibold mb-4 text-base-content">Featured Record</h2>
            <a href={`/records/${featuredRecord["lynching-id"]}`} class="block bg-white border border-amber-200 rounded-lg p-5 shadow-md hover:shadow-lg transition-shadow">
              <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-shrink-0">
                  <img 
                    src={`/mapimages/${featuredRecord["lynching-id"]}.png`}
                    alt={`Map showing location of ${featuredRecord["city"] || featuredRecord["county"]}, ${featuredRecord["state"]}`}
                    class="w-full md:w-48 h-32 object-cover rounded-lg border border-gray-200"
                    onerror="this.style.display='none'"
                  />
                </div>
                <div class="flex-1">
                  <div class="flex justify-between items-start mb-2">
                    <h3 class="text-lg font-display font-semibold text-gray-900">{featuredRecord["narrative-short-title"]}</h3>
                    <span class="text-sm text-gray-500 ml-2 flex-shrink-0">{featuredRecord["date"]}</span>
                  </div>
                  <p class="text-sm text-gray-600 mb-2">
                    {featuredRecord["city"] ? `${featuredRecord["city"]}, ` : ''}{featuredRecord["state"]} • {featuredRecord["event-type"]}
                  </p>
                  <p class="text-sm text-gray-700 line-clamp-3">
                    {featuredRecord["narrative-body"] || featuredRecord["narrative-summary"]}
                  </p>
                  <span class="inline-block mt-3 text-sm font-medium text-accent hover:text-accent-focus">Read full record →</span>
                </div>
              </div>
            </a>
            </div>
          )}
        </div>

        <footer class="text-center mt-12 pt-8 border-t border-base-300">
          <div class="mb-3">
            <a href="/accessibility" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-vintage-ink bg-amber-50 hover:bg-amber-100 border border-amber-300 rounded-lg transition-colors duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              WCAG 2.2 AA Compliant
            </a>
          </div>
          <p class="text-sm font-body text-base-content/70">
            © Kevin Hegg, 2025. This website contains sensitive historical content. Please approach the material with respect and care.
          </p>
        </footer>
      </div>
    </main>
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>
