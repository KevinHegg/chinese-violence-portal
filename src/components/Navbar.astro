---
// Global navbar component with johncrow theme
export interface Props {
  currentPage?: string;
}

const { currentPage } = Astro.props;
---

<script>
  // Set active nav item based on current page
  document.addEventListener('DOMContentLoaded', () => {
    const currentPage = document.body.getAttribute('data-current-page');
    const navItems = document.querySelectorAll('.nav-item');
    
    navItems.forEach(item => {
      const link = item.querySelector('a');
      if (link) {
        const href = link.getAttribute('href');
        if ((href === '/' && currentPage === 'home') || href === `/${currentPage}`) {
          item.classList.add('active');
        }
      }
    });

    // Mobile menu toggle
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        // Toggle aria-expanded for accessibility
        const isExpanded = mobileMenu.classList.contains('hidden') ? 'false' : 'true';
        mobileMenuButton.setAttribute('aria-expanded', isExpanded);
      });
    }
  });
</script>

<!-- Aggressive content fade at very top of viewport -->
<div class="pointer-events-none fixed left-0 right-0" style="top: 0; height: 40px; z-index: 60;">
  <div class="fade-content-mask w-full h-full"></div>
</div>

<!-- Aggressive fade mask above navbar -->
<div class="pointer-events-none fixed left-0 right-0" style="top: 0; height: 40px; z-index: 50;">
  <div class="fade-navbar-mask w-full h-full"></div>
</div>

<!-- Global navbar -->
<nav class="navbar bg-amber-50 border-b border-t border-amber-200 shadow-sm fixed left-0 right-0 z-50 min-h-10" style="top: 30px;">
  <div class="navbar-start">
    <!-- Mobile menu button - visible on screens smaller than 800px -->
    <button id="mobile-menu-button" class="btn btn-ghost btn-sm p-2 mobile-menu-btn" aria-label="Toggle mobile menu" aria-expanded="false">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>
  
  <div class="navbar-center flex-1 flex justify-center">
    <!-- Desktop menu - hidden on small screens -->
    <ul class="menu menu-horizontal px-1 gap-2 desktop-menu">
      <li class="nav-item relative">
        <a href="/" class="nav-link flex items-center gap-1 font-body text-sm text-base-content hover:text-accent hover:underline decoration-accent decoration-1 transition-all duration-200 pb-1 border-b-2 border-transparent">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
          </svg>
          Welcome
        </a>
      </li>
      <li>
        <span class="text-base-300 font-body text-sm">|</span>
      </li>
      <li class="nav-item relative">
        <a href="/dataset" class="nav-link flex items-center gap-1 font-body text-sm text-base-content hover:text-accent hover:underline decoration-accent decoration-1 transition-all duration-200 pb-1 border-b-2 border-transparent" aria-label="View and contribute to the anti-Chinese violence dataset">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <!-- Table/Grid/Dataset icon -->
            <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2" fill="none" />
            <path stroke="currentColor" stroke-width="2" d="M3 9h18M3 13h18M7 5v14M17 5v14" />
          </svg>
          Lynching Records
        </a>
      </li>
      <li>
        <span class="text-base-300 font-body text-sm">|</span>
      </li>
      <li class="nav-item relative">
        <a href="/chat" class="nav-link flex items-center gap-1 font-body text-sm text-base-content hover:text-accent hover:underline decoration-accent decoration-1 transition-all duration-200 pb-1 border-b-2 border-transparent">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
          Ask the Archive
        </a>
      </li>
      <li>
        <span class="text-base-300 font-body text-sm">|</span>
      </li>
      <li class="nav-item relative">
        <a href="/explore" class="nav-link flex items-center gap-1 font-body text-sm text-base-content hover:text-accent hover:underline decoration-accent decoration-1 transition-all duration-200 pb-1 border-b-2 border-transparent">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5h10M11 9h7M11 13h4M7 5v14m0 0H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2v12z" />
            <circle cx="17" cy="17" r="3" stroke="currentColor" stroke-width="2" fill="none" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-2-2" />
          </svg>
          Explore the Records
        </a>
      </li>
      <li>
        <span class="text-base-300 font-body text-sm">|</span>
      </li>
      <li class="nav-item relative">
        <a href="/visualize" class="nav-link flex items-center gap-1 font-body text-sm text-base-content hover:text-accent hover:underline decoration-accent decoration-1 transition-all duration-200 pb-1 border-b-2 border-transparent">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          Visualize the Data
        </a>
      </li>
      <li>
        <span class="text-base-300 font-body text-sm">|</span>
      </li>
      <li class="nav-item relative">
        <a href="/sources" class="nav-link flex items-center gap-1 font-body text-sm text-base-content hover:text-accent hover:underline decoration-accent decoration-1 transition-all duration-200 pb-1 border-b-2 border-transparent">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
          Sources
        </a>
      </li>
    </ul>
  </div>
  
  <div class="navbar-end">
    <!-- Empty for now -->
  </div>
</nav>

<!-- Mobile menu overlay -->
<div id="mobile-menu" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden mobile-menu-overlay">
  <div class="absolute top-16 left-0 right-0 bg-amber-50 border-b border-amber-200 shadow-lg">
    <ul class="menu bg-amber-50 w-full">
      <li class="nav-item">
        <a href="/" class="nav-link flex items-center gap-2 font-body text-sm text-base-content hover:text-accent hover:bg-amber-100 p-4">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
          </svg>
          Welcome
        </a>
      </li>
      <li class="nav-item">
        <a href="/dataset" class="nav-link flex items-center gap-2 font-body text-sm text-base-content hover:text-accent hover:bg-amber-100 p-4" aria-label="View and contribute to the anti-Chinese violence dataset">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2" fill="none" />
            <path stroke="currentColor" stroke-width="2" d="M3 9h18M3 13h18M7 5v14M17 5v14" />
          </svg>
          Lynching Records
        </a>
      </li>
      <li class="nav-item">
        <a href="/chat" class="nav-link flex items-center gap-2 font-body text-sm text-base-content hover:text-accent hover:bg-amber-100 p-4">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
          Ask the Archive
        </a>
      </li>
      <li class="nav-item">
        <a href="/explore" class="nav-link flex items-center gap-2 font-body text-sm text-base-content hover:text-accent hover:bg-amber-100 p-4">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5h10M11 9h7M11 13h4M7 5v14m0 0H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2v12z" />
            <circle cx="17" cy="17" r="3" stroke="currentColor" stroke-width="2" fill="none" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-2-2" />
          </svg>
          Explore the Records
        </a>
      </li>
      <li class="nav-item">
        <a href="/visualize" class="nav-link flex items-center gap-2 font-body text-sm text-base-content hover:text-accent hover:bg-amber-100 p-4">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          Visualize the Data
        </a>
      </li>
      <li class="nav-item">
        <a href="/sources" class="nav-link flex items-center gap-2 font-body text-sm text-base-content hover:text-accent hover:bg-amber-100 p-4">
          <svg class="nav-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
          Sources
        </a>
      </li>
    </ul>
  </div>
</div>

<!-- Spacer to prevent content from being hidden behind fixed navbar -->
<div class="h-[60px]"></div>

<style>
  /* Ensure navbar layout works correctly */
  .navbar {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    width: 100% !important;
    margin-top: 0 !important;
  }
  
  .navbar-start {
    flex-shrink: 0 !important;
  }
  
  .navbar-center {
    flex: 1 !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
  }
  
  .navbar-end {
    flex-shrink: 0 !important;
  }
  
  /* Ensure menu items are properly displayed */
  .menu-horizontal {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    gap: 0.5rem !important;
  }
  
  .menu-horizontal li {
    display: flex !important;
    align-items: center !important;
  }
  
  /* Active nav item styles */
  .nav-item.active .nav-link {
    color: #1f1f1f !important; /* dark text on brown background */
    font-weight: 600 !important;
    background-color: #d4c4a8 !important; /* lighter brown background */
    border-radius: 0.375rem !important;
    padding: 0.25rem 0.5rem !important;
    border-bottom-color: transparent !important;
  }
  
  .nav-item.active .nav-icon {
    color: #1f1f1f !important; /* dark text on brown background */
  }

  /* Mobile menu styles */
  #mobile-menu {
    transition: opacity 0.2s ease-in-out;
  }

  /* Mobile active state */
  #mobile-menu .nav-item.active .nav-link {
    background-color: #d4c4a8 !important;
    color: #1f1f1f !important;
    font-weight: 600 !important;
  }

  /* Custom breakpoint for mobile menu at 800px */
  .mobile-menu-btn {
    display: none !important;
  }
  
  .desktop-menu {
    display: flex !important;
  }
  
  .mobile-menu-overlay {
    display: none !important;
  }

  /* Show mobile menu button and hide desktop menu below 800px */
  @media (max-width: 800px) {
    .mobile-menu-btn {
      display: block !important;
    }
    
    .desktop-menu {
      display: none !important;
    }
    
    /* Mobile menu overlay should be hidden by default, only shown when toggled */
    .mobile-menu-overlay {
      display: none !important;
    }
    
    /* When mobile menu is active (not hidden), show it */
    .mobile-menu-overlay:not(.hidden) {
      display: block !important;
    }
  }

  .fade-navbar-mask {
    background: linear-gradient(to top, rgba(251, 246, 232, 0.7) 0%, rgba(251, 246, 232, 0) 100%);
    /* rgba(251,246,232) is close to Tailwind's amber-50 */
  }
  .fade-content-mask {
    background: linear-gradient(to top, rgba(251, 246, 232, 0) 0%, rgba(255,255,255,1) 100%);
    /* Fades from transparent at bottom to opaque white at top */
  }
</style> 